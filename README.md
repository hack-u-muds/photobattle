# Photo Battle - リアルタイム写真カードバトルゲーム

写真から自動生成されたカードを使って友達とリアルタイムでバトルできるWebアプリケーションです。

## 🎮 ゲームの特徴

- **写真からカード生成**: 3枚の写真をアップロードして、攻撃力と属性を持つバトルカードを自動生成
- **リアルタイム対戦**: Socket.IOによるリアルタイム通信で友達とオンライン対戦
- **属性相性システム**: 火・水・土の3属性による戦略的なバトル（火 > 土 > 水 > 火）
- **レスポンシブデザイン**: PC・スマートフォン両対応
- **Wi-Fi対応**: 同一ネットワーク内での対戦可能

## 🎯 ゲームの流れ

1. **マッチング**: ルームを作成するか、友達のルームに参加
2. **カード生成**: 3枚の写真をアップロードしてバトルカードを作成
3. **バトル**: 3ラウンド制で、各ラウンドでカードを1枚選択して戦闘
4. **勝敗決定**: 2勝先取または3ラウンド終了時の勝利数で決着

## 🔧 技術スタック

### バックエンド
- **Flask**: Webフレームワーク
- **Flask-SocketIO**: リアルタイム通信
- **OpenCV**: 画像処理・特徴量抽出
- **PIL (Pillow)**: カード画像生成
- **NumPy**: 数値計算

### フロントエンド
- **HTML5/CSS3**: レスポンシブUI
- **JavaScript (ES6+)**: インタラクティブ機能
- **Socket.IO Client**: リアルタイム通信

### 画像処理技術
- **色相・彩度・明度分析**: 属性決定アルゴリズム
- **エッジ検出**: 複雑さ評価
- **特徴量抽出**: 攻撃力算出

## 📁 ファイル構成

```
photo_battle/
├── app.py                 # メインサーバー (Socket.IO + API)
├── api_server.py          # API専用サーバー (カード生成API)
├── card_generator.py      # カード生成エンジン
├── matching.html          # マッチング画面
├── card-generation.html   # カード生成画面
├── battle.html            # バトル画面
├── uploads/               # アップロード画像保存
├── generated_cards/       # 生成カード保存
└── README.md
```

## 🚀 セットアップ

### 必要な環境
- Python 3.8+
- pip
- Git

### インストール

1. **リポジトリのクローン**
```bash
git clone https://github.com/hack-u-muds/photobattle
```
```bash
cd photo_battle
```

2. **仮想環境の作成とアクティベート**
```bash
python -m venv .venv
```
# Windowsの場合
```bash
.\.venv\Scripts\activate
```
# macOS/Linuxの場合
```bash
source .venv/bin/activate
```

3. **依存関係のインストール**
```bash
pip install -r requirements.txt
```

### 起動方法
このアプリケーションは、メインサーバーとカード生成APIサーバーの2つの部分で構成されています。それぞれを別のターミナルで起動する必要があります。
#### 1: 画像生成APIサーバーの起動(ターミナル１)
```bash
python api_interface.py
```
#### 2: メインサーバーの起動 (ターミナル2)
```bash
python app.py
```

### アクセス方法

起動後、以下のURLにアクセス：

- **自分のPC**: http://localhost:5000/
- **同じWi-Fi内**: http://[あなたのローカルIP]:5000/
- **スマホ**: http://[あなたのローカルIP]:5000/

## 🎲 ゲームルール

### 属性相性
- **火属性**: 土に有利、水に不利
- **水属性**: 火に有利、土に不利  
- **土属性**: 水に有利、火に不利

### ダメージ計算
- **有利**: 攻撃力 × 1.5（切り上げ）
- **等倍**: 攻撃力 × 1.0
- **不利**: 攻撃力 × 0.8（切り下げ）

### 勝利条件
- 3ラウンド中2勝先取
- または3ラウンド終了時の勝利数比較

## 🎨 カード生成アルゴリズム

### 攻撃力決定（10-100）
- **色の多様性**: 色相の分散
- **複雑さ**: エッジ密度
- **コントラスト**: 明度の分散
- **彩度**: 色の鮮やかさ
- **解像度**: 画像サイズ

### 属性決定
- **火属性**: 赤系・暖色・高彩度・複雑な画像
- **水属性**: 青系・寒色・高コントラスト・シンプルな画像
- **土属性**: 緑・茶系・低彩度・自然な画像

## 🐛 トラブルシューティング

### 接続エラー
1. ファイアウォール設定を確認
2. 同一Wi-Fiネットワークに接続されているか確認
3. ローカルIPアドレスが正しいか確認

### カード生成エラー
1. 画像ファイル形式を確認（PNG, JPG, JPEG, GIF, BMP）
2. ファイルサイズを確認（16MB以下）
3. `uploads/` と `generated_cards/` フォルダの書き込み権限を確認

### バトル同期エラー
ページを再読み込みして再接続を試してください。

## 🔧 デバッグ機能

開発・テスト用のエンドポイント：

- **ルーム状態確認**: `/debug/room/ROOM_ID`
- **カード移行**: `/debug/migrate-cards/ROOM_ID`
- **ルーム修復**: `/debug/fix-room/ROOM_ID`

## 📱 対応環境

- **PC**: Chrome, Firefox, Safari, Edge
- **スマートフォン**: iOS Safari, Android Chrome
- **タブレット**: iPad, Android タブレット

## 🎯 今後の拡張予定

- ユーザーアカウント機能
- 戦績記録・ランキング
- 更多属性とスキルシステム
- AI対戦モード
- カードコレクション機能

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。


---

**バトルをお楽しみください！** ⚔️🎴